diff --git a/CMakeLists.txt b/CMakeLists.txt
index e551b8e5c2..eae36d3403 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -37,9 +37,13 @@ add_library(${MOVEIT_LIB_NAME} SHARED
   src/BenchmarkExecutor.cpp
 )
 set_target_properties(${MOVEIT_LIB_NAME} PROPERTIES VERSION "${${PROJECT_NAME}_VERSION}")
+if(WIN32)
+  set(EXTRA_LIB ws2_32.lib)
+endif()
 ament_target_dependencies(${MOVEIT_LIB_NAME}
   ${THIS_PACKAGE_INCLUDE_DEPENDS}
 )
+target_link_libraries(${MOVEIT_LIB_NAME} ${EXTRA_LIB})
 
 add_executable(moveit_run_benchmark src/RunBenchmark.cpp)
 ament_target_dependencies(moveit_run_benchmark
diff --git a/src/BenchmarkExecutor.cpp b/src/BenchmarkExecutor.cpp
index bbd774a25c..58a90c714e 100644
--- a/src/BenchmarkExecutor.cpp
+++ b/src/BenchmarkExecutor.cpp
@@ -49,12 +49,15 @@
 #include <boost/math/constants/constants.hpp>
 #include <boost/filesystem.hpp>
 #include <boost/date_time/posix_time/posix_time.hpp>
+#include <limits>
 #ifndef _WIN32
 #include <unistd.h>
 #else
 #include <winsock2.h>
 #endif
 
+#undef max
+
 using namespace moveit_ros_benchmarks;
 
 static const rclcpp::Logger LOGGER = rclcpp::get_logger("moveit.ros.benchmarks.BenchmarkExecutor");